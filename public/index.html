<!doctype html>
<html>
  <head>
      <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
      <script type="text/javascript" src="ol-debug.js"></script>
      <link rel="stylesheet" href="http://openlayers.org/en/v3.17.1/css/ol.css" type="text/css" media="screen">


      <script src="/socket.io/socket.io.js"></script>
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
      <link href="//cdn.jsdelivr.net/openlayers.geocoder/latest/ol3-geocoder.min.css" rel="stylesheet">
      <script src="//cdn.jsdelivr.net/openlayers.geocoder/latest/ol3-geocoder.js"></script>
      <script src="https://cdn.rawgit.com/bjornharrtell/jsts/gh-pages/1.2.0/jsts.min.js"></script>
      
    <title>Land App</title>
    <style>
      /** { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }*/
    </style>
  </head>
  <body>

      <div class="chat page">
          <form action="">
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                  <ul class="nav navbar-nav">
                      <a class="navbar-brand" href="#">Land App</a>
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">File<span class="caret"></span></a>
                          <ul class="dropdown-menu">
                              <li><a onclick="newProject();" href="#">New Project</a></li>
                              <li><a onclick="openProject();" href="#">Open Project</a></li>
                          </ul>
                      </li>
                  </ul>
              </div>


              <div class="col-xs-12">
                  <div class="col-xs-3" style="float:left;">
                      <div class="panel panel-default">
                          <div class="panel-body">
                              <br />
                              <br />
                             
                              <div class="dropdown">
                              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                  Draw Feature
                                  <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu" id="dropdownshapes" aria-labelledby="dropdownMenu1">
                                  <li><a  onclick="drawShape('Point');" href="#">Point</a></li>
                                  <li><a onclick="drawShape('Polygon');" href="#">Polygon</a></li>
                                  <li><a onclick="drawShape('LineString');" href="#">LineString</a></li>
                                  <li><a onclick="drawShape('Circle');" href="#">Circle</a></li>
                              </ul>
                              </div>
                              <br />
                              <br />
                              <button type="button"class="btn btn-danger" onclick="bufferfeature();">Buffer</button>
                          </div>
                      </div>
                      <div class="alert alert-info" id="area"></div>
                      <div class="panel panel-default" style="display: none;">
                          <div class="panel-body">
                              <label>Chat</label>
                              <ul id="messages"></ul>
                              <input type="text" placeholder="Type here..." class="form-control" id="m" autocomplete="off" />
                              <br />
                              <button id="btnSend" class="btn btn-default">Send</button>
                          </div>
                      </div>
                  </div>


                  <div id=map class="col-xs-9" style="float:right;"></div>
                  
                  <div id="popup" class="ol-popup">
                      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                      <div id="popup-content"></div>
                  </div>
              </div>

          </form>
      </div>


        <script>
            var socket = io();
            
            //socket.connect("http://localhost", { 'force new connection': true });
            $('form').submit(function () {
                socket.emit('chat message', $('#m').val());
                $('#m').val('');
                
                return false;
            });

            socket.on('conversation private post', function (data) {
                //display data.message
            });

            socket.on('new polygon', function (data) {
                //display data.message
                var geom = new ol.geom.Polygon(data.message);
                console.log(geom);
                redrawShape(geom);
            });

            socket.on('chat message', function (msg) {
                $('#messages').append($('<li>').text(msg));
            });

            socket.on('delete feature', function (msg) {
                removeFeature(msg);
            });


            //socket.on('new polygon', function (msg) {

            //    var geom = new ol.geom.Polygon(msg);
            //    console.log(geom);
            //    redrawShape(geom);    
            //});

            socket.on('new circle', function (msg) {
                var radius = msg.substr(0, msg.indexOf(','));
                var centerString = msg.substring(msg.indexOf(",") + 1);
                var centerArray = centerString.split(',').map(Number);
                var geom = new ol.geom.Circle([centerArray[0],centerArray[1]], radius);
                redrawShape(geom);
            });

            socket.on('new linestring', function (msg) {

                var geom = new ol.geom.LineString(msg);
                redrawShape(geom);
            });

            socket.on('new point', function (msg) {

                var geom = new ol.geom.Point(msg);
                redrawShape(geom);
            });
            //socket.on('newID', function (msg) {

            //    setNewID(msg);
            //});
            
</script>

      <script type="text/javascript" src="main.js"></script>
  </body>
</html>